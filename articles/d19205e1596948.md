---
title: "Expressã®Requestå‹ã‚’æ‹¡å¼µã™ã‚‹"
emoji: "ğŸ“Œ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["typescript", "nodejs", "express"]
published: true
publication_name: "no4_dev"
---

Express ã® Request å‹ã‚’æ‹¡å¼µã—ã‚ˆã†ã¨ã—ã¾ã—ãŸã€
åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰èª­ã¿è¾¼ã‚“ã§ãã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ã®æƒ…å ±ãŒè¦‹ã¤ã‹ã‚‰ãªã‹ã£ãŸãŸã‚ã€
å‚™å¿˜éŒ²ã¨ã—ã¦æ®‹ã—ã¦ãŠãã¾ã™ã€‚

## ç’°å¢ƒ

```bash
$ node -v
v18.19.0
$ npm -v
10.2.3
```

```json:package.json (ä¸€éƒ¨æŠœç²‹)
{
  // ....
  "dependencies": {
    // ....
    "express": "^4.18.2",
    // ....
  },
  "devDependencies": {
    // ....
    "@types/express": "^4.17.21",
    "@types/node": "^18.18.2",
    // ....
    "typescript": "^5.3.3"
    // ....
  }
}
```

## tsconfig

```json: tsconfig.json (ä¸€éƒ¨æŠœç²‹)
{
  "compilerOptions": {
    // ...
    "baseUrl": "./",
    "paths": {
      "~/*": ["./src/*"],
    },
    // ...
    "typeRoots": ["./src/@types"],
    // ...
  },
  // ...
}
```

## å‹å®šç¾©

```ts:src/@types/express/index.d.ts
// -----

type Context = {
  // Utility Typesã¯é€šå¸¸é€šã‚Šä½¿ãˆã‚‹
  client: ReturnType<
    // åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰å‹ã‚’èª­ã¿è¾¼ã‚€å ´åˆã¯import()ã‚’åˆ©ç”¨ã™ã‚‹
    typeof import('openapi-fetch').default<
      // ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã‚‚åˆ©ç”¨ã§ãã‚‹
      import('~/generated/api').paths
    >
  >;
}

declare namespace Express {
  interface Request {
    // æ¨™æº–ã®å‹ã¯ãã®ã¾ã¾åˆ©ç”¨ã§ãã‚‹
    token: string;
    // åŒä¸€ãƒ•ã‚¡ã‚¤ãƒ«å†…ã§å®šç¾©ã•ã‚ŒãŸå‹ã¯åˆ©ç”¨ã§ãã‚‹
    context: Context;
  }
}

// -----
```

### å‹å®šç¾© (NG ä¾‹)

#### ãƒ•ã‚¡ã‚¤ãƒ«ç½®ãå ´é–“é•ã„

vscode ã¯ã‚¨ãƒ©ãƒ¼ã«ãªã‚‰ãªã„ãŒã€ãƒ“ãƒ«ãƒ‰æ™‚ã«å¤±æ•—ã™ã‚‹

```ts:src/@types/express.d.ts
// -----

type Context = {
  // Utility Typesã¯é€šå¸¸é€šã‚Šä½¿ãˆã‚‹
  client: ReturnType<
    // åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰å‹ã‚’èª­ã¿è¾¼ã‚€å ´åˆã¯import()ã‚’åˆ©ç”¨ã™ã‚‹
    typeof import('openapi-fetch').default<
      // ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã‚‚åˆ©ç”¨ã§ãã‚‹
      import('~/generated/api').paths
    >
  >;
}

declare namespace Express {
  interface Request {
    // æ¨™æº–ã®å‹ã¯ãã®ã¾ã¾åˆ©ç”¨ã§ãã‚‹
    token: string;
    // åŒä¸€ãƒ•ã‚¡ã‚¤ãƒ«å†…ã§å®šç¾©ã•ã‚ŒãŸå‹ã¯åˆ©ç”¨ã§ãã‚‹
    context: Context;
  }
}

// -----
```

#### import from ã‚’åˆ©ç”¨ã™ã‚‹å ´åˆ

vscode ã§å‹æ‹¡å¼µãŒç„¡è¦–ã•ã‚Œã‚‹

```ts:src/@types/express/index.d.ts
import type createClient from 'openapi-fetch';
import type { paths } from '~/generated/api';

// -----

type Context = {
  // Utility Typesã¯é€šå¸¸é€šã‚Šä½¿ãˆã‚‹
  client: ReturnType<
    typeof createClient<paths>
  >;
}

declare namespace Express {
  interface Request {
    // æ¨™æº–ã®å‹ã¯ãã®ã¾ã¾åˆ©ç”¨ã§ãã‚‹
    token: string;
    // åŒä¸€ãƒ•ã‚¡ã‚¤ãƒ«å†…ã§å®šç¾©ã•ã‚ŒãŸå‹ã¯åˆ©ç”¨ã§ãã‚‹
    context: Context;
  }
}

// -----
```

## æœ€å¾Œã«

ä»–ã«ã‚‚ã‚‚ã£ã¨ã†ã¾ã„ã‚„ã‚Šæ–¹ãŒã‚ã‚Œã°ã€ã‚³ãƒ¡ãƒ³ãƒˆæ¬„ã§æ•™ãˆã¦ã„ãŸã ã‘ã‚‹ã¨å¹¸ã„ã§ã™ã€‚
(chat GPT ã«ã‚‚èã„ã¦ã¿ã¾ã—ãŸãŒã€å‹•ã‹ãªã„ã‚³ãƒ¼ãƒ‰ã—ã‹æ•™ãˆã¦ãã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚ã€‚ã€‚)
