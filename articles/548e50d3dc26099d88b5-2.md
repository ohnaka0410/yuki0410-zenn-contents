---
title: "Geolocation API ã‚’Promiseã‚’ä½¿ã£ã¦ãƒ©ãƒƒãƒ—ã™ã‚‹(TypeScriptåˆ©ç”¨)"
emoji: "ğŸ“Œ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["JavaScript", "TypeScript", "Geolocation"]
published: true
publication_name: "no4_dev"
---

[Geolocation API](https://developer.mozilla.org/ja/docs/Web/API/Geolocation/Using_geolocation) ã‚’æ‰±ã„æ˜“ãã™ã‚‹ãŸã‚ã€Promise ã‚’ä½¿ã£ã¦ãƒ©ãƒƒãƒ—ã—ãŸã®ã§å¿˜å‚™éŒ²ã«ã€‚
â€» [Geolocation API ã‚’ Promise ã§ãƒ©ãƒƒãƒ—ã—ã¦æ‰±ã†ï¼ˆTypeScriptï¼‰](https://qiita.com/makotoyc/items/aee473b341cd3a7bd31f)ã‚’å‚è€ƒã«ã€ã‚‚ã†å°‘ã—ç´°ã‹ãå‹ã‚’æ›¸ã„ã¦ã¿ã¾ã—ãŸã€‚

## ã‚¯ãƒ©ã‚¹å®šç¾©

```typescript:Geolocation.ts
/**
 * ä½ç½®æƒ…å ±ã‚¯ãƒ©ã‚¹
 */
class Geolocation {
  /**
   * ç¾åœ¨ä½ç½®å–å¾—å‡¦ç†
   */
  static getCurrentPosition(): Promise<Position> {
    return new Promise<Position>(
      (
        resolve: (position: Position) => void,
        reject: (positionError: PositionError) => void,
      ) => {
      if (!navigator.geolocation) {
        // ä½ç½®æƒ…å ±APIãŒåˆ©ç”¨ã§ããªã„å ´åˆ
        // è‡ªå‰ã§PositionErrorã‚’ä½œæˆ
        const error:PositionError = {
          code: undefined,
          message: 'geolocation not supported.',
          PERMISSION_DENIED: undefined,
          POSITION_UNAVAILABLE: undefined,
          TIMEOUT: undefined,
        }
        reject(error);
      }
      const geolocation: Geolocation = navigator.geolocation
      // æˆåŠŸã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯
      const successCallback:PositionCallback = (position: Position): void => {
        resolve(position)
      }
      // ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯
      const errorCallback:PositionErrorCallback = (positionError: PositionError): void => {
        reject(positionError)
      }
      // ã‚ªãƒ—ã‚·ãƒ§ãƒ³å®šç¾©
      const options: PositionOptions = {
        // enableHighAccuracy: boolean,
        // maximumAge: number,
        // timeout: number,
      }
      // ç¾åœ¨ä½ç½®å–å¾—
      geolocation.getCurrentPosition(successCallback, errorCallback, options);
    });
  }
}
```

## å‘¼ã³å‡ºã—

```typescript:index.ts
/**
 * ä½ç½®æƒ…å ±æ›´æ–°å‡¦ç†
 */
const updatePosition = async () => {
  try {
    const position: Position = await Geolocation.getCurrentPosition()
    console.log(position)
    // [object GeolocationPosition] {
    //   coords: [object GeolocationCoordinates] {
    //     latitude: XX.XXXXXXX,
    //     longitude: XXX.XXXXXX,
    //     altitude: null,
    //     accuracy: 4507,
    //     altitudeAccuracy: null,
    //     heading: null,
    //     speed: null,
    //   },
    //   timestamp: 1577702787855,
    // }
  } catch (positionError) {
    console.log(positionError)
    // [object GeolocationPositionError] {
    //   code: 1,
    //   message: "User denied Geolocation",
    //   PERMISSION_DENIED: 1,
    //   POSITION_UNAVAILABLE: 2,
    //   TIMEOUT: 3,
    // }
  }
}

updatePosition()
```

ãƒ­ãƒ¼ã‚«ãƒ«ã«ç’°å¢ƒã‚’ä½œã‚‰ãªãã¦ã‚‚ã€[CodePen.io](https://codepen.io/)ãªã©ã§ç°¡å˜ã«è©¦ã›ã¾ã™ã€‚

## å‚è€ƒ

- [Geolocation API](https://developer.mozilla.org/ja/docs/Web/API/Geolocation/Using_geolocation)
- Interface
  - [Geolocation](https://microsoft.github.io/PowerBI-JavaScript/interfaces/_node_modules_typedoc_node_modules_typescript_lib_lib_dom_d_.geolocation.html)
  - [PositionCallback](https://microsoft.github.io/PowerBI-JavaScript/interfaces/_node_modules_typedoc_node_modules_typescript_lib_lib_dom_d_.positioncallback.html)
  - [Position](https://microsoft.github.io/PowerBI-JavaScript/interfaces/_node_modules_typedoc_node_modules_typescript_lib_lib_dom_d_.position.html)
  - [PositionErrorCallback](https://microsoft.github.io/PowerBI-JavaScript/interfaces/_node_modules_typedoc_node_modules_typescript_lib_lib_dom_d_.positionerrorcallback.html)
  - [PositionError](https://microsoft.github.io/PowerBI-JavaScript/interfaces/_node_modules_typedoc_node_modules_typescript_lib_lib_dom_d_.positionerror.html)
  - [PositionOptions](https://microsoft.github.io/PowerBI-JavaScript/interfaces/_node_modules_typedoc_node_modules_typescript_lib_lib_dom_d_.positionoptions.html)
