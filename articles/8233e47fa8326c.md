---
title: "openapi-ts ã§ç”Ÿæˆã™ã‚‹ å‹å®šç¾©ã¨ OpenAPI Client"
emoji: "ğŸ“Œ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["openapi", "typescript", "openapits"]
published: true
publication_name: "no4_dev"
---

## ã¯ã˜ã‚ã«

OpenAPI ã®å®šç¾©ã‹ã‚‰ OpenAPI Client ã‚’ç”Ÿæˆã™ã‚‹ãƒ„ãƒ¼ãƒ«ã¨ã„ãˆã°ã€[openapi-generator](https://openapi-generator.tech/)ãŒãƒ¡ã‚¸ãƒ£ãƒ¼ã§ã™ãŒã€å‹•ä½œã•ã›ã‚‹ãŸã‚ã« Java ã¾ãŸã¯ Docker ãŒå¿…è¦ã¨ãªã‚‹ãŸã‚æ‰±ã„ã¥ã‚‰ã„ã¨æ„Ÿã˜ã¦ã„ã¾ã—ãŸã€‚
ã¾ãŸã€Client/Server ã§æ§˜ã€…ãªè¨€èª/FW ã«å¯¾å¿œã—ã¦ã„ã‚‹ãŸã‚å¿…è¦ãªæƒ…å ±ãŒèª¿ã¹ã«ããã€ã¾ãŸã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚„æ§‹æ–‡ã®å¯¾å¿œçŠ¶æ³ã«å·®ç•°ãŒã‚ã‚Šåˆ¥ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã®ãƒŠãƒ¬ãƒƒã‚¸ãŒä½¿ã„ã¾ã‚ã—ã«ãã„å°è±¡ã§ã—ãŸã€‚

ä»£æ›¿ã¨ã—ã¦ã€openapi-typescript ã¨ openapi-fetch ãŒè‰¯ã•ãã†ãªã®ã§ã€ä½¿ã„æ–¹ã‚’è¦‹ã¦ã„ã“ã†ã¨æ€ã„ã¾ã™ã€‚

https://openapi-ts.pages.dev/

https://www.npmjs.com/package/openapi-typescript

https://www.npmjs.com/package/openapi-fetch

## å‰æ

OpenAPI ã®å®šç¾©ã¯ã€Swagger ãŒå…¬é–‹ã—ã¦ã„ã‚‹[ã‚µãƒ³ãƒ—ãƒ«](https://petstore3.swagger.io/)ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚

## å°å…¥

### openapi-typescript

openapi-typescript ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™

```bash
$ npm i -D openapi-typescript
```

ç”Ÿæˆã®ãŸã‚ã® scripts ã‚’è¿½è¨˜ã—ã¾ã™

```diff json:package.json
{
  // ...
  "scripts": {
    // ...
+     "pregenerate": "npm run clean:generate",
+     "generate": "openapi-typescript https://petstore3.swagger.io/api/v3/openapi.json -o ./src/generated/oas.d.ts",
    // ...
+     "clean:generate": "node -e 'fs.rmSync(`src/generated`, {recursive:true, force:true})'",
    // ...
  },
  "devDependencies": {
    // ...
+     "openapi-typescript": "^6.7.4",
    // ...
    "typescript": "^5.3.3"
    // ...
  }
}

```

å‹å®šç¾©ã‚’ç”Ÿæˆã—ã¾ã™ã€‚

```bash
$ npm run generate
```

:::details #ref ã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹å ´åˆ

@redocly/cli ã‚’åˆ©ç”¨ã—ã€äº‹å‰ã« OpenAPI å®šç¾©ã‚’ 1 ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¾ã¨ã‚ã¾ã™

```bash
$ npm i -D @redocly/cli
```

```diff json:package.json
{
  // ...
  "scripts": {
    // ...
+    "oas": "redocly bundle [ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆã®OpenAPIãƒ•ã‚¡ã‚¤ãƒ«] --output [å‡ºåŠ›å…ˆ]",
    // ...
    "pregenerate": "npm run clean:generate",
+     // â†“å…¥åŠ›ã‚’oasã®å‡ºåŠ›å…ˆã«åˆã‚ã›ã‚‹
    "generate": "openapi-typescript https://petstore3.swagger.io/api/v3/openapi.json -o ./src/generated/oas.d.ts",
    // ...
+    "clean:oas": "node -e 'fs.rmSync(`oas`, {recursive:true, force:true})'",
    "clean:generate": "node -e 'fs.rmSync(`src/generated`, {recursive:true, force:true})'",
    // ...
  },
  "devDependencies": {
    // ...
    "openapi-typescript": "^6.7.4",
    // ...
    "typescript": "^5.3.3"
    // ...
  }
}

```

```bash
$ npm run oas
$ npm run generate
```

:::

### openapi-fetch

openapi-fetch ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™

```bash
$ npm i openapi-fetch
```

client ã®ä½œæˆ

```ts:src/client.ts
import createClient from 'openapi-fetch';

import type { paths } from './generated/oas';

// -----

/**
 * Client
 */
export const client = createClient<paths>({
  baseUrl: `https://petstore3.swagger.io/api/v3`,
});

// -----

```

APi ã®å‘¼ã³å‡ºã—

```ts
const {
  data, // only present if 2XX response
  error, // only present if 4XX or 5XX response
  response,
} = await client.GET("/pet/findByStatus", {
  params: {
    query: {
      status: "available",
    },
  },
});

console.log("data", data);
console.log("error", error);
```

```ts
const {
  data, // only present if 2XX response
  error, // only present if 4XX or 5XX response
  response,
} = await client.GET("/pet/{petId}", {
  params: {
    path: {
      petId: 10,
    },
  },
});

console.log("data", data);
console.log("error", error);
```

```ts
const {
  data, // only present if 2XX response
  error, // only present if 4XX or 5XX response
  response,
} = await client.POST("/pet", {
  body: {
    id: 10,
    name: "doggie",
    category: {
      id: 1,
      name: "Dogs",
    },
    photoUrls: ["string"],
    tags: [
      {
        id: 0,
        name: "string",
      },
    ],
    status: "available",
  },
});

console.log("data", data);
console.log("error", error);
```

## åˆ©ç”¨ä¾‹

### å‹å®šç¾©ã®å–å¾—

```ts
import type { components } from "./generated/oas";

type schemas = components["schemas"];
type responses = components["responses"];
type parameters = components["parameters"];
type requestBodies = components["requestBodies"];
type headers = components["headers"];
type pathItems = components["pathItems"];
```

### èªè¨¼ãƒ˜ãƒƒãƒ€ãƒ¼ã®ä»˜ä¸

```ts
import createClient from "openapi-fetch";

import type { paths } from "./generated/oas";

// -----

/**
 * Client
 */
export const client = createClient<paths>({
  baseUrl: `https://petstore3.swagger.io/api/v3`,
  fetch: async (
    input: string | URL | globalThis.Request,
    init?: RequestInit
  ): Promise<Response> => {
    const token = "";

    return fetch(input, {
      ...init,
      headers: new Headers({
        ...init?.headers,
        Authorization: `Bearer ${token}`,
      }),
    });
  },
});

// -----
```

### ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼ã®å–å¾—

```ts
const { data, error, response } = await client.GET("/pet/findByStatus", {
  params: {
    query: {
      status: "available",
    },
  },
});

console.log("headers", response.headers);
```

## ã•ã„ã”ã«

ã—ã£ã‹ã‚Šå‹è£œå®ŒãŒèãã¤ã¤ã‚‚ã€ã‚·ãƒ³ãƒ—ãƒ«ãªæ§‹æˆãªãŸã‚ã€è¦ä»¶ã«å¿œã˜ã¦ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã§ãã‚‹ãŸã‚ã€æ¨ã›ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã—ãŸã€‚
