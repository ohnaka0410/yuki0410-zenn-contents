---
title: "React.ts ã®çŠ¶æ…‹ç®¡ç†ã« useContext ã‚’ä½¿ã†"
emoji: "ğŸ“Œ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["TypeScript", "React", "useContext"]
published: true
publication_name: "no4_dev"
---

React ã®çŠ¶æ…‹ç®¡ç†ã®æ–¹æ³•ã§è¿·ã£ãŸã®ã§ã€
é¸æŠè‚¢ã¨ãã®ç‰¹å¾´ã‚’ã¾ã¨ã‚ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚

## React ã®çŠ¶æ…‹ç®¡ç†ã®ä¸»ãªæ–¹æ³•

- **useState**
- **useContext** :round_pushpin:
- **Redux**

ä»Šå›ã¯ã€**useContext**ã‚’ä½¿ã£ãŸçŠ¶æ…‹ç®¡ç†ã®æ–¹æ³•ã«ã¤ã„ã¦ã¾ã¨ã‚ã¦ã„ãã¾ã™ã€‚

## useContext ã‚’ä½¿ã£ãŸçŠ¶æ…‹ç®¡ç†ã®ãƒã‚¤ãƒ³ãƒˆ

- **React.createContext**ã§ç”Ÿæˆã—ãŸ Context ã‚’ Store ã¨ã—ã¦ç®¡ç†ã™ã‚‹ã€‚
- Store ã«ã¯**React.useReducer**ã§ç”Ÿæˆã—ãŸã€**State**ã¨**Dispatch**ã‚’æ ¼ç´ã™ã‚‹ã€‚
- Content ã®**Provider Component**ã§å›²ã¿ã€Scope ã‚’æ±ºå®šã™ã‚‹ã€‚
- Store ã‚’åˆ©ç”¨ã™ã‚‹éš›ã¯ã€**React.useContext**ã§å–å¾—ã™ã‚‹ã€‚
- Store ã«æ ¼ç´ã—ãŸ**State**ã‹ã‚‰çŠ¶æ…‹ã‚’èª­ã¿å–ã‚‹ã€‚
- Store ã«æ ¼ç´ã—ãŸ**Dispatch**ã‹ã‚‰çŠ¶æ…‹ã‚’å¤‰æ›´ã™ã‚‹ã€‚

## useContext ã‚’ä½¿ã£ãŸçŠ¶æ…‹ç®¡ç†ã®ä¾‹

### store

> - **React.createContext**ã§ç”Ÿæˆã—ãŸ Context ã‚’ Store ã¨ã—ã¦ç®¡ç†ã™ã‚‹ã€‚
> - Store ã«ã¯**React.useReducer**ã§ç”Ÿæˆã—ãŸã€**State**ã¨**Dispatch**ã‚’æ ¼ç´ã™ã‚‹ã€‚

```tsx:store.tsx
import * as React from 'react';

/**
 * Itemã®å‹å®šç¾©
 */
export interface Item
  extends Readonly<{
    name: string;
  }> {}

/**
 * Stateã®å‹å®šç¾©
 */
export interface State
  extends Readonly<{
    list: Item[];
  }> {}

/**
 * ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®å‹å®šç¾©
 */
export interface Action
  extends Readonly<{
    type: 'SAVE' | 'DELETE';
    payload: Item;
  }> {}

type Reducer = React.Reducer<State, Action>;

export type Dispatch = React.Dispatch<Action>;

/**
 * ã‚¹ãƒˆã‚¢ã®å‹å®šç¾©
 */
export interface Store
  extends Readonly<{
    /*
     * State
     */
    state: State;
    /**
     * Dispatch
     */
    dispatch: Dispatch;
  }> {}

/**
 * Propsã®å‹å®šç¾©
 */
interface Props
  extends Readonly<{
    /*
     * Child Elements
     */
    children: React.ReactNode;
  }> {}

/**
 * Default Store
 */
const defaultStore: Store = {
  state: {
    list: [],
  },
  dispatch: (action: Action): void => {},
};

/**
 * Reducer
 */
const reducer: Reducer = (prevState: State, action: Action): State => {
  // å„å‡¦ç†ã¯åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ã«åˆ†å‰²ã—ã¦ã‚‚ã‚ˆã„ã€‚
  switch (action.type) {
    case 'SAVE':
      // (ry
      return {...prevState};
    // break;
    case 'DELETE':
      // (ry
      return {...prevState};
    // break;
    default:
      throw new TypeError(`Illegal type of action: ${action.type}`);
    // break;
  }
};

/**
 * Context
 */
export const context: React.Context<Store> = React.createContext<Store>(
  defaultStore
);

/**
 * Provider Component
 */
export const Provider: React.FC<Props> = (props: Props): JSX.Element => {
  const [state, dispatch]: [State, Dispatch] = React.useReducer<Reducer>(
    reducer,
    defaultStore.state
  );

  return (
    <>
      <context.Provider value={{state, dispatch}}>
        {props.children}
      </context.Provider>
    </>
  );
};

```

### Page Component

> - Content ã®**Provider Component**ã§å›²ã¿ã€Scope ã‚’æ±ºå®šã™ã‚‹ã€‚

```tsx:Page.tsx
import * as React from 'react';
import List from './List';
import {Provider} from './store';

/**
 * Propsã®å‹å®šç¾©
 */
interface Props
  extends Readonly<{
    /*
     * Child Elements
     */
    children?: never;
  }> {}

/**
 * Page Component
 */
const Page: React.FC<Props> = (props: Props): JSX.Element => {
  return (
    <Provider>
      <List />
    </Provider>
  );
};

export default Page;

```

### List Component

> - Store ã‚’åˆ©ç”¨ã™ã‚‹éš›ã¯ã€**React.useContext**ã§å–å¾—ã™ã‚‹ã€‚
> - Store ã«æ ¼ç´ã—ãŸ**State**ã‹ã‚‰çŠ¶æ…‹ã‚’èª­ã¿å–ã‚‹ã€‚

```tsx:List.tsx
import * as React from 'react';
import ListItem from './ListItem';
import type {Item, State, Store} from './store';
import {context} from './store';

/**
 * Propsã®å‹å®šç¾©
 */
interface Props
  extends Readonly<{
    /*
     * Child Elements
     */
    children?: never;
  }> {}

/**
 * List Component
 */
const List: React.FC<Props> = (props: Props): JSX.Element => {
  // Storeã‹ã‚‰Stateã‚’å–ã‚Šå‡ºã™ã€‚
  const {state}: {state: State} = React.useContext<Store>(context);

  return (
    <>
      <ul>
        {state.list.map(
          (item: Item, index: number): JSX.Element => {
            return <ListItem key={index} item={item} />;
          }
        )}
      </ul>
    </>
  );
};

export default List;

```

### List Item Component

> - Store ã‚’åˆ©ç”¨ã™ã‚‹éš›ã¯ã€**React.useContext**ã§å–å¾—ã™ã‚‹ã€‚
> - Store ã«æ ¼ç´ã—ãŸ**Dispatch**ã‹ã‚‰çŠ¶æ…‹ã‚’å¤‰æ›´ã™ã‚‹ã€‚

```tsx:ListItem.tsx
import * as React from 'react';
import type {Dispatch, Item, Store, Action} from '../../store';
import {context} from '../../store';

/**
 * Propsã®å‹å®šç¾©
 */
interface Props
  extends Readonly<{
    /*
     * Child Elements
     */
    children?: never;
    /**
     * Item
     */
    item: Item;
  }> {}

/**
 * List Item Component
 */
const ListItem: React.FC<Props> = (props: Props): JSX.Element => {
  // Storeã‹ã‚‰Dispatchã‚’å–ã‚Šå‡ºã™ã€‚
  const {dispatch}: {dispatch: Dispatch} = React.useContext<Store>(context);

  // Dispatchã«æ¸¡ã™Actionã‚’å®šç¾©ã—ã¦ãŠãã€‚
  const saveAction: Action = {
    type: 'SAVE',
    payload: props.item,
  };

  return (
    <li>
      {props.item.name}
      <button
        onClick={(
          event: React.MouseEvent<HTMLButtonElement, MouseEvent>
        ): void => {
          dispatch(saveAction);
        }}
      >
        SAVE
      </button>
    </li>
  );
};

export default ListItem;

```

## ã¾ã¨ã‚

- ãƒ¡ãƒªãƒƒãƒˆ
  - React ä»¥å¤–ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«ä¾å­˜ã—ãªã„ã€‚
  - Provider ã‚’ç½®ãå ´æ‰€ã«ã‚ˆã£ã¦ Global ã‚„ä»»æ„ã®ç¯„å›²ã®ã‚¹ã‚³ãƒ¼ãƒ—ã«çµã‚‹ã“ã¨ãŒã§ãã‚‹:mag:
  - **prop drilling** ãŒå°‘ãªãã¦ã™ã‚€ã€‚
- ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ
  - Scope ã‚’åºƒãã—ã™ãã‚‹ã¨ã€ã©ã“ã‹ã‚‰å¤‰æ›´ã•ã‚Œã¦ã„ã‚‹ã‹è¿½ã„ã¥ã‚‰ããªã‚‹
  - éåŒæœŸå‡¦ç†ã«ã¯å¯¾å¿œå‡ºæ¥ã¦ã„ãªã„ãŸã‚ã€è‡ªå‰ã§ãªã‚“ã¨ã‹ã—ãªã„ã¨ã„ã‘ãªã„:innocent:
