---
title: "ç‹¬ç«‹ã—ãŸã‚³ã‚¢ãƒ¬ã‚¤ãƒ¤ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’JavaScript(TypeScript)ã§å®Ÿè£…ã—ã¦ã¿ã‚‹"
emoji: "ğŸ’¡"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["JavaScript", "TypeScript"]
published: true
publication_name: "no4_dev"
---

[@shin1x1](https://twitter.com/shin1x1)ã•ã‚“ã®[ç‹¬ç«‹ã—ãŸã‚³ã‚¢ãƒ¬ã‚¤ãƒ¤ãƒ‘ã‚¿ãƒ¼ãƒ³](https://blog.shin1x1.com/entry/independent-core-layer-pattern)ã‚’ JS(TS)ã§ã‚‚åˆ©ç”¨ã§ãã‚‹ã¨ã„ã„ã‹ãªã¨æ€ã„ã€ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã‚’ä½œæˆã—ã¦ã¿ãŸã€‚

# ç‹¬ç«‹ã—ãŸã‚³ã‚¢ãƒ¬ã‚¤ãƒ¤ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ã¯ï¼Ÿ

- ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ã²ã¨ã¤
- ã‚³ã‚¢ãƒ¬ã‚¤ãƒ¤ã¨ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¬ã‚¤ãƒ¤ã® 2 ã¤ã®ãƒ¬ã‚¤ãƒ¤ã‹ã‚‰ãªã‚‹
  - ã‚³ã‚¢ãƒ¬ã‚¤ãƒ¤
    - ã‚³ã‚¢ãƒ¬ã‚¤ãƒ¤ãƒ­ã‚¸ãƒƒã‚¯ã‚„ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…ã™ã‚‹
    - å¤–éƒ¨ã® IF(WebAPI ã‚„ DB ã® orm ãªã©)ã«ã¯ä¾å­˜ã—ãªã„
  - ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¬ã‚¤ãƒ¤
    - ã‚³ã‚¢ãƒ¬ã‚¤ãƒ¤ã¨å¤–éƒ¨ã® IF ã®é€£æºã‚’å®Ÿè£…ã™ã‚‹
    - å¤–éƒ¨ã® IF(WebAPI ã‚„ DB ã® orm ãªã©)ã«ä¾å­˜ã™ã‚‹
- **ã‚¹ãƒ¼ãƒ‘ãƒ¼ãƒ’ãƒ¼ãƒ­ãƒ¼ãŒã„ãªãã¦ã‚‚ä½¿ãˆã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³**

# ã‚´ãƒ¼ãƒ«

ã‚µãƒ³ãƒ—ãƒ«ã¨ã—ã¦ã€è¨˜äº‹ã«å¯¾ã™ã‚‹ãƒ•ã‚¡ãƒœ(ãŠæ°—ã«å…¥ã‚Š)ã‚’è¨­å®šãƒ»è§£é™¤ã™ã‚‹æ©Ÿèƒ½ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã‚’ä½œæˆã™ã‚‹ã€‚

## ã‚µãƒ³ãƒ—ãƒ«ãƒªãƒã‚¸ãƒˆãƒª

[ohnaka0410/Vue-Ts-Independent-Core-Layer-Pattern](https://github.com/ohnaka0410/Vue-Ts-Independent-Core-Layer-Pattern)

# å®Ÿè£…

## ãƒ™ãƒ¼ã‚¹

ã‚µã‚¯ãƒƒã¨ TS ç’°å¢ƒã‚’æ§‹ç¯‰ã—ãŸã‹ã£ãŸã®ã§ã€[@vue/cli](https://www.npmjs.com/package/@vue/cli)ã‚’åˆ©ç”¨ã—ãŸã€‚

## ã‚³ã‚¢ãƒ¬ã‚¤ãƒ¤

> ã‚³ã‚¢ãƒ¬ã‚¤ãƒ¤ã¯ã€ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã¨ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ãŒåˆ©ç”¨ã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã®ãƒãƒ¼ãƒˆï¼ˆã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹ï¼‰ã‚’å®Ÿè£…ã™ã‚‹ã€‚ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã¯ã€æƒ³å®šã•ã‚Œã‚‹å‡¦ç†ã‚’é †ã«è¨˜è¿°ã—ã¦ã„ãã€‚ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹ãªã©æŠ€è¡“è©³ç´°ã‚’åˆ©ç”¨ã—ãŸã„å ´åˆã€å¿…è¦ãª API ã‚’ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹ã¨ã—ã¦å®Ÿè£…ã—ã¦ã€ãã‚Œã«ä¾å­˜ã—ã¦ãŠãã€‚ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å†…ã§ã¯ã€ã“ã®ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹ã‚’åˆ©ç”¨ã—ã¦å€¤ã®å–å¾—ã‚„ä¿å­˜ãªã©ã®å‡¦ç†ã‚’è¡Œã†ã€‚

â€»[æœ¬å®¶ã‚µã‚¤ãƒˆ](https://blog.shin1x1.com/entry/independent-core-layer-pattern#%E3%82%B3%E3%82%A2%E3%83%AC%E3%82%A4%E3%83%A4)ã‚ˆã‚Šå¼•ç”¨

### ãƒ¢ãƒ‡ãƒ«

```typescript:src/modules/Sample/Article/Core/Model/Article.ts
/**
 * è¨˜äº‹ã‚¯ãƒ©ã‚¹
 */
export default class Article {
  /** è¨˜äº‹ID */
  private id: number;

  /**
   * ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿
   */
  public constructor(id:number) {
    this.id = id;
  }

  /**
   * IDå–å¾—å‡¦ç†
   */
  public getId() {
    return this.id;
  }
}
```

```typescript:src/modules/Sample/Article/Core/Model/ArticleFav.ts
/**
 * è¨˜äº‹ãŠæ°—ã«å…¥ã‚Šã‚¯ãƒ©ã‚¹
 */
export default class ArticleFav {
  /** è¨˜äº‹ID */
  private articleId: number;
  /** ãƒ¦ãƒ¼ã‚¶ID */
  private userId: number;
  /** è¨˜äº‹ãŠæ°—ã«å…¥ã‚ŠID */
  private id: number | undefined;

  /**
   * ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿
   */
  public constructor(articleId:number, userId:number, id?:number) {
    this.articleId = articleId;
    this.userId = userId;
    this.id = id;
  }

  /**
   * è¨˜äº‹IDå–å¾—å‡¦ç†
   */
  public getArticleId(): number {
    return this.articleId;
  }

  /**
   * ãƒ¦ãƒ¼ã‚¶IDå–å¾—å‡¦ç†
   */
  public getUserId(): number {
    return this.userId;
  }

  /**
   * è¨˜äº‹ãŠæ°—ã«å…¥ã‚ŠIDå–å¾—å‡¦ç†
   */
  public getId(): number | undefined {
    return this.id;
  }
}

```

### ã‚¨ã‚¯ã‚»ãƒ—ã‚·ãƒ§ãƒ³

```typescript:src/modules/Sample/Article/Core/Exception/NotFoundException.ts
/**
 * 404ã‚¨ãƒ©ãƒ¼ã‚¨ã‚¯ã‚»ãƒ—ã‚·ãƒ§ãƒ³ã‚¯ãƒ©ã‚¹
 */
export default class NotFoundException extends Error {}
```

### ãƒãƒ¼ãƒˆ

```typescript:src/modules/Sample/Article/Core/Port/ToggleFavPort.d.ts
import Article from '../Model/Article';
import ArticleFav from '../Model/ArticleFav';

/**
 * ãŠæ°—ã«å…¥ã‚Šåˆ‡ã‚Šæ›¿ãˆIF
 */
export default interface ToggleFavPort {
  /**
   * è¨˜äº‹å–å¾—å‡¦ç†
   */
  findArticle(articleId: number): Promise<Article | undefined>;
  /**
   * è¨˜äº‹ãŠæ°—ã«å…¥ã‚Šå–å¾—å‡¦ç†
   */
  findArticleFav(
    articleId: number,
    userId: number
  ): Promise<ArticleFav | undefined>;
  /**
   * è¨˜äº‹ãŠæ°—ã«å…¥ã‚Šä¿å­˜å‡¦ç†
   */
  saveArticleFav(articleFav: ArticleFav): Promise<void>;
  /**
   * è¨˜äº‹ãŠæ°—ã«å…¥ã‚Šå‰Šé™¤å‡¦ç†
   */
  deleteArticleFav(articleFav: ArticleFav): Promise<void>;
}
```

### ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹

```typescript:src/modules/Sample/Article/Core/UseCase/ToggleFav.ts
import ToggleFavPort from '../Port/ToggleFavPort';
import NotFoundException from '../Exception/NotFoundException';
import Article from '../Model/Article';
import ArticleFav from '../Model/ArticleFav';

/**
 * ãŠæ°—ã«å…¥ã‚Šåˆ‡ã‚Šæ›¿ãˆãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã‚¯ãƒ©ã‚¹
 */
export default class ToggleFav {
  /**
   * ãŠæ°—ã«å…¥ã‚Šåˆ‡ã‚Šæ›¿ãˆå®Ÿè£…ãƒãƒ¼ãƒˆ
   */
  private port: ToggleFavPort;

  /**
   * ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿
   */
  public constructor(port: ToggleFavPort) {
    this.port = port;
  }

  /**
   * ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å®Ÿè¡Œå‡¦ç†
   */
  public async run(
    articleId: number,
    on: boolean,
    userId: number
  ): Promise<void> {
    if (!articleId) {
      throw new NotFoundException('articleId not found');
    }

    const article: Article | undefined = await this.port.findArticle(articleId);
    if (!article) {
      throw new NotFoundException('Article not found');
    }

    const articleFav: ArticleFav | undefined = await this.port.findArticleFav(
      article.getId(),
      userId
    );

    if (on) {
      await this.port.saveArticleFav(
        articleFav || new ArticleFav(article.getId(), userId)
      );
    } else {
      if (articleFav) {
        await this.port.deleteArticleFav(articleFav);
      }
    }
  }
}
```

## ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¬ã‚¤ãƒ¤

> ã‚µãƒ¼ãƒ“ã‚¹ãƒ¬ã‚¤ãƒ¤ã¯ã€UI ã‚„ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãªã©ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å¤–éƒ¨ã¨ã®é€£æºã‚’å®Ÿè£…ã™ã‚‹ã€‚
>
> ã“ã®ãƒ¬ã‚¤ãƒ¤ã§ã¯ã€2 ã¤ã®è²¬å‹™ã‚’æ‹…ã†ã€‚1 ã¤ç›®ã¯ã€UI ã‹ã‚‰ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å¥‘æ©Ÿã«ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ã‚ã‚‹ã€‚ã‚³ã‚¢ãƒ¬ã‚¤ãƒ¤ã‹ã‚‰æä¾›ã•ã‚Œã‚‹ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã‚¯ãƒ©ã‚¹ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã«ãªã‚‹ã€‚2 ã¤ç›®ã¯ã€å®Ÿè¡Œã™ã‚‹ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ãŒä¾å­˜ã—ã¦ã„ã‚‹ãƒãƒ¼ãƒˆã«å¯¾ã™ã‚‹ã‚¢ãƒ€ãƒ—ã‚¿ã‚’å®Ÿè£…ã™ã‚‹ã“ã¨ã ã€‚ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹ã‚’æº€ãŸã›ã°ã€ãã®å®Ÿè£…ã®è©³ç´°ã¯è‡ªç”±ã§ã‚ã‚‹ã€‚

â€»[æœ¬å®¶ã‚µã‚¤ãƒˆ](https://blog.shin1x1.com/entry/independent-core-layer-pattern#%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%83%AC%E3%82%A4%E3%83%A4)ã‚ˆã‚Šå¼•ç”¨

### ã‚¢ãƒ€ãƒ—ã‚¿

å®Ÿéš›ã¯[axios](https://www.npmjs.com/package/axios)ãªã©ã‚’ä½¿ã£ã¦ API ã‚’å©ã„ãŸã‚Šã€FireBase ã® FireStorage ã¸ã®ä¿å­˜å‡¦ç†ã‚’è¡Œã†æƒ³å®šã§ã™ã€‚

```typescript:src/modules/Sample/Article/Application/Adapter/ToggleFavAdapter.ts
import ToggleFavPort from '../../Core/Port/ToggleFavPort';
import Article from '../../Core/Model/Article';
import ArticleFav from '../../Core/Model/ArticleFav';

/**
 * ãŠæ°—ã«å…¥ã‚Šåˆ‡ã‚Šæ›¿ãˆã‚¢ãƒ€ãƒ—ã‚¿ã‚¯ãƒ©ã‚¹
 */
export default class ToggleFavAdapter implements ToggleFavPort {
  /**
   * è¨˜äº‹å–å¾—å‡¦ç†
   */
  public async findArticle(articleId: number): Promise<Article | undefined> {
    console.log("findArticle");
    console.log(articleId);
    // call api
    // return dummy data
    return new Article(articleId);
  }
  /**
   * è¨˜äº‹ãŠæ°—ã«å…¥ã‚Šå–å¾—å‡¦ç†
   */
  public async findArticleFav(
    articleId: number,
    userId: number
  ): Promise<ArticleFav | undefined> {
    console.log("findArticleFav");
    console.log(articleId);
    console.log(userId);
    // call api
    // return dummy data
    const dummyArticleFavId =1;
    return new ArticleFav(articleId, userId, dummyArticleFavId);
  }
  /**
   * è¨˜äº‹ãŠæ°—ã«å…¥ã‚Šä¿å­˜å‡¦ç†
   */
  public async saveArticleFav(articleFav: ArticleFav): Promise<void> {
    console.log("saveArticleFav");
    // call api
  }
  /**
   * è¨˜äº‹ãŠæ°—ã«å…¥ã‚Šå‰Šé™¤å‡¦ç†
   */
  public async deleteArticleFav(articleFav: ArticleFav): Promise<void> {
    console.log("deleteArticleFav");
    // call api
  }
}
```

## å‘¼ã³å‡ºã—éƒ¨åˆ†

â€»DI ã‚³ãƒ³ãƒ†ãƒŠã®å®Ÿè£…ã¯çœç•¥ã€‚

```src/App.vue
<template>
  <div id="app">
    <img alt="Vue logo" src="./assets/logo.png" />
    <HelloWorld msg="Welcome to Your Vue.js + TypeScript App" />
    <button @click="toggleFav">ToggleFav</button>
  </div>
</template>

<script lang="ts">
import { Component, Vue } from "vue-property-decorator";
import HelloWorld from "./components/HelloWorld.vue";

import ToggleFavUseCase from "./modules/Sample/Article/Core/UseCase/ToggleFav";
import ToggleFavAdapter from "./modules/Sample/Article/Application/Adapter/ToggleFavAdapter";
const useCase = new ToggleFavUseCase(new ToggleFavAdapter());

@Component({
  components: {
    HelloWorld
  },
  methods: {
    toggleFav: () => {
      const articleId: number = 11;
      const on: boolean = true;
      // const on: boolean = false;
      const userId: number = 22;
      useCase.run(articleId, on, userId);
    }
  }
})
export default class App extends Vue {}
</script>

<style>
#app {
  font-family: "Avenir", Helvetica, Arial, sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  text-align: center;
  color: #2c3e50;
  margin-top: 60px;
}
</style>
```

# ã¾ã¨ã‚

- TypeScript ã§ã‚ã‚Œã°å‹ãŒåˆ©ç”¨ã§ãã‚‹ã®ã§ã€åˆ©ç”¨ã§ããã†ã€‚(VanillaJS ã§ã‚‚é ‘å¼µã‚Œã°ãªã‚“ã¨ã‹ã€‚ã€‚ã€‚)
- ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ¼ã»ã©ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒå¤šããªã„ã®ã§ã€æ¯”è¼ƒçš„æ°—è»½ã«å°å…¥ã§ããã†ã€‚
- æ¡ˆä»¶è¦æ¨¡ã‚„é–‹ç™ºãƒ¡ãƒ³ãƒãƒ¼ã®ã‚¹ã‚­ãƒ«ã«å¿œã˜ã¦ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã‚’å…¥ã‚Œã‚‹ã“ã¨ã‚‚ã§ããã†ã€‚
