---
title: "ãã®useCallbackã¡ã‚ƒã‚“ã¨åŠ¹ã„ã¦ã„ã¾ã™ã‹"
emoji: "ğŸ‘»"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [React, TypeScript, hooks]
published: true
publication_name: "no4_dev"
---

onChange ã« useCallback ã‚’ä½¿ã†å ´åˆã€ã¡ã‚ƒã‚“ã¨ useCallback ãŒåŠ¹ãæ›¸ãæ–¹ãŒã²ã¨ã‚¯ã‚»ã‚ã£ãŸã®ã§ãã®å‚™å¿˜éŒ²ã§ã™ã€‚

## #1.å‡¦ç†ãƒ•ãƒ­ãƒ¼

ä»Šå›ã¯ã€ã‚ˆãã‚ã‚‹ä»¥ä¸‹ã®ã‚ˆã†ãªå‡¦ç†ã«ã¤ã„ã¦è€ƒãˆã¦ã„ãã¾ã™ã€‚

[![uml](http://www.plantuml.com/plantuml/png/XP1D2WCX34RtEKMOVNk0Bih0BBhj0Re9eym8ceW_xVLhRGMHWMv4a_TC-EQOAAJiB6n1iiUuomkcEmNDwS6BE2zShXDIH5-hYAShJijkh1g1zLF42px9PWtrzQLlWLYjHyfMExrtPdATV4Ge7TTWV3B2e5d1RtVXPIVUD7HA-Q2vhTsD-K-EunhRmXZXkizSZXBf6m00)](http://www.plantuml.com/plantuml/uml/XP1D2WCX34RtEKMOVNk0Bih0BBhj0Re9eym8ceW_xVLhRGMHWMv4a_TC-EQOAAJiB6n1iiUuomkcEmNDwS6BE2zShXDIH5-hYAShJijkh1g1zLF42px9PWtrzQLlWLYjHyfMExrtPdATV4Ge7TTWV3B2e5d1RtVXPIVUD7HA-Q2vhTsD-K-EunhRmXZXkizSZXBf6m00)

## #2.Coding

ã¾ãšã¯å‡¦ç†ãƒ•ãƒ­ãƒ¼ã‚’å…ƒã« show/onChange ã®å‡¦ç†ã‚’å®Ÿè£…ã—ã¾ã™ã€‚  
â€»ã“ã®æ®µéšã§ã¯ã¾ã  ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã¯æ°—ã«ã—ã¾ã›ã‚“ã€‚

```tsx:ParentComponent.tsx
import { useState } from "react";
import type { InputValue } from "~/ChildComponent";
import { ChildComponent } from "~/ChildComponent";

export const ParentComponent: React.VFC<{}> = () => {
  const [value, setValue] = useState<InputValue>({
    name: "defaultName",
    description: "defaultDescription",
  });

  const handleChange = (newValue: InputValue): void => {
    setValue(newValue);
  };

  return <ChildComponent value={value} onChange={handleChange} />;
};

```

```tsx:ChildComponent.tsx
import { GrandchildComponent } from "~/GrandchildComponent";

export type InputValue = {
  name: string;
  description: string;
};

type Props = {
  value: InputValue;
  onChange: (value: InputValue) => void;
};

export const ChildComponent: React.VFC<Props> = ({ value, onChange }) => {
  const handleChangeName = (newValue: string): void => {
    onChange({
      ...value,
      name: newValue,
    });
  };

  const handleChangeDescription = (newValue: string): void => {
    onChange({
      ...value,
      description: newValue,
    });
  };

  return (
    <>
      <GrandchildComponent value={value.name} onChange={handleChangeName} />
      <GrandchildComponent value={value.description} onChange={handleChangeDescription} />
    </>
  );
};
```

```tsx:GrandchildComponent.tsx
type Props = {
  value: string;
  onChange: (value: string) => void;
};

export const GrandchildComponent: React.VFC<Props> = ({ value, onChange }) => {
  const handleChange = (event: React.ChangeEvent<HTMLInputElement>): void => {
    const newValue = event.target.value;
    onChange(newValue);
  };

  return <input value={value} onChange={handleChange} />;
};

```

## #3.Performance tuning ğŸ‘»

[React.memo](https://ja.reactjs.org/docs/react-api.html#reactmemo) ã¨ [useCallback](https://ja.reactjs.org/docs/hooks-reference.html#usecallback)ã‚’ä½¿ã£ã¦å†ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’æŠ‘æ­¢ã—ã¦ã„ãã¾ã™ã€‚

```tsx:ParentComponent.tsx
import { memo, useCallback, useState } from "react";
import type { InputValue } from "~/ChildComponent";
import { ChildComponent } from "~/ChildComponent";

export const ParentComponent: React.VFC<{}> = memo(() => {
  const [value, setValue] = useState<InputValue>({
    name: "defaultName",
    description: "defaultDescription",
  });

  const handleChange = useCallback((newValue: InputValue): void => {
    setValue(newValue);
  }, []);

  return <ChildComponent value={value} onChange={handleChange} />;
});

```

```tsx:ChildComponent.tsx
import { memo, useCallback } from "react";
import { GrandchildComponent } from "~/GrandchildComponent";

export type InputValue = {
  name: string;
  description: string;
};

type Props = {
  value: InputValue;
  onChange: (value: InputValue) => void;
};

export const ChildComponent: React.VFC<Props> = memo(({ value, onChange }) => {
  const handleChangeName = useCallback(
    (newValue: string): void => {
      onChange({
        ...value,
        name: newValue,
      });
    },
    [onChange, value]
  );

  const handleChangeDescription = useCallback(
    (newValue: string): void => {
      onChange({
        ...value,
        description: newValue,
      });
    },
    [onChange, value]
  );

  return (
    <>
      <GrandchildComponent value={value.name} onChange={handleChangeName} />
      <GrandchildComponent value={value.description} onChange={handleChangeDescription} />
    </>
  );
});

```

```tsx:GrandchildComponent.tsx
import { memo, useCallback } from "react";

type Props = {
  value: string;
  onChange: (value: string) => void;
};

export const GrandchildComponent: React.VFC<Props> = memo(({ value, onChange }) => {
  const handleChange = useCallback(
    (event: React.ChangeEvent<HTMLInputElement>): void => {
      const newValue = event.target.value;
      onChange(newValue);
    },
    [onChange]
  );

  return <input value={value} onChange={handleChange} />;
});

```

## #4.Performance tuning ğŸ¤”

`React.memo`ã‚‚`useCallback`ã‚‚å°å…¥ã§ãã€ä¸€è¦‹ã“ã‚Œã§ä¸è¦ãªå†ãƒ¬ãƒ³ãƒ€ãƒ¼ãŒæŠ‘æ­¢ã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸã‚ˆã†ã«è¦‹ãˆã¾ã™ã€‚  
ã—ã‹ã—ã€ä»¥ä¸‹ã®ç®‡æ‰€ã§ã¯ã€useCallback ã®`deps`ã«`value`ãŒå«ã¾ã‚Œã¦ã„ã‚‹ãŸã‚ã€ä»–æ–¹ã®å€¤ãŒå¤‰æ›´ã•ã‚ŒãŸå ´åˆã‚‚ã€ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ãŒå†ç”Ÿæˆã•ã‚Œã¾ã™ã€‚  
e.g. `value.name`ãŒå¤‰æ›´ã•ã‚ŒãŸå ´åˆã€`value`ãŒå¤‰æ›´ã•ã‚Œã‚‹ãŸã‚`handleChangeName`ã ã‘ã§ã¯ãªã`handleChangeDescription`ã‚‚å†ç”Ÿæˆã•ã‚Œã¾ã™ã€‚

```tsx:ChildComponent.tsx
// ãƒ»ãƒ»ãƒ»

export const ChildComponent: React.VFC<Props> = memo(({ value, onChange }) => {
  const handleChangeName = useCallback(
    (newValue: string): void => {
      onChange({
        ...value,
        name: newValue,
      });
    },
    [onChange, value]
  );

  const handleChangeDescription = useCallback(
    (newValue: string): void => {
      onChange({
        ...value,
        description: newValue,
      });
    },
    [onChange, value]
  );
});

```

## #5.Performance tuning ğŸ§

ChildComponent ã®`onChange`ã®å‹ã‚’å¤‰æ›´ã—ã€useCallback ã®`deps`ã‹ã‚‰`value`ã‚’æŠœãã“ã¨ã«ã‚ˆã‚Šã€ã•ã‚‰ã«ä¸è¦ãªæœ€ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’æŠ‘æ­¢ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```tsx:ParentComponent.tsx
import { memo, useCallback, useState } from "react";
import type { InputValue } from "~/ChildComponent";
import { ChildComponent } from "~/ChildComponent";

export const ParentComponent: React.VFC<{}> = memo(() => {
  const [value, setValue] = useState<InputValue>({
    name: "defaultName",
    description: "defaultDescription",
  });

  const handleChange = useCallback((callback: (prevValue: InputValue) => InputValue): void => {
    setValue((prevValue: InputValue): InputValue => {
      return callback(prevValue);
    });
  }, []);

  return <ChildComponent value={value} onChange={handleChange} />;
});

```

```tsx:ChildComponent.tsx
import { memo, useCallback } from "react";
import { GrandchildComponent } from "~/GrandchildComponent";

export type InputValue = {
  name: string;
  description: string;
};

type Props = {
  value: InputValue;
  onChange: (callback: (prevValue: InputValue) => InputValue) => void;
};

export const ChildComponent: React.VFC<Props> = memo(({ value, onChange }) => {
  const handleChangeName = useCallback(
    (newValue: string): void => {
      onChange((prevValue: InputValue): InputValue => {
        return {
          ...prevValue,
          name: newValue,
        };
      });
    },
    [onChange]
  );

  const handleChangeDescription = useCallback(
    (newValue: string): void => {
      onChange((prevValue: InputValue): InputValue => {
        return {
          ...prevValue,
          description: newValue,
        };
      });
    },
    [onChange]
  );

  return (
    <>
      <GrandchildComponent value={value.name} onChange={handleChangeName} />
      <GrandchildComponent value={value.description} onChange={handleChangeDescription} />
    </>
  );
});

```

```tsx:GrandchildComponent.tsx
import { memo, useCallback } from "react";

type Props = {
  value: string;
  onChange: (value: string) => void;
};

export const GrandchildComponent: React.VFC<Props> = memo(({ value, onChange }) => {
  const handleChange = useCallback(
    (event: React.ChangeEvent<HTMLInputElement>): void => {
      const newValue = event.target.value;
      onChange(newValue);
    },
    [onChange]
  );

  return <input value={value} onChange={handleChange} />;
});

```

## #6.ã•ã„ã”ã«

ã‚°ã‚°ã£ã¦ã‚‚ã‚ã¾ã‚Šã“ã‚Œã«é–¢ã™ã‚‹è¨˜äº‹ãŒå‡ºã¦ã“ãªã‹ã£ãŸã®ã§ã€æƒ…å ±ã‚ã‚Šã¾ã—ãŸã‚‰ã€ã‚³ãƒ¡ãƒ³ãƒˆæ¬„ã‚„ãƒ„ã‚¤ãƒƒã‚¿ãƒ¼ã§æ•™ãˆã¦ã„ãŸã ã‘ã‚‹ã¨å¬‰ã—ã„ã§ã™ã€‚
